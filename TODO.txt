=============================================================================
2025-11-29

The dust_wx PicoW firmware seems to get jammed for (as yet) unknown reasons.

Operation can be resumed by halting and restarting the CircuitPython firmware;
i.e.: a hardware reboot of the PicoW does not seem necessary.

System config:
'dust' : sensor control, data collection, transmits to syslog over WIFI
  Raspberry Pi Pico W
  CircuitPython v9.2.8
  CircuitPython_dust_wx_station v0.2.0.2
  ipattr 192.168.8.60
'wopr' : Linux box running ssh server, diagnostics bridge over USB tty to REPL
  Raspberry Pi Zero W
  RaspiOS 13 'trixie'
  ipattr 192.168.8.19

To restart the firmware:
    ssh mew@wopr  # connect to 'wopr' diagnostics bridge.
    screen /dev/ttyACM0 115200 # connect to 'dust' REPL over USB
    # hit control-C to KeyboardInterrupt the stalled firmware
    # hit control-D to

-----------------------------------------------------------------------------
-----------------------------------------------------------------------------
-----------------------------------------------------------------------------
###mew### no reports in >60mins

"2025-11-30T09:14:45Z",-7.0,51.3,734.9,0.575,1.0,1.0,1.0,1.0,7,8,8,8,8
###mew### hit CTRL-C
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 227, in <module>
  File "main.py", line 160, in AcquireData
  File "adafruit_htu21d.py", line 142, in relative_humidity
  File "adafruit_htu21d.py", line 128, in _data
KeyboardInterrupt:
192.168.8.60 | 128@adafruit_htu21d.py KeyboardInterrupt | 9.2.8
Code done running.

Press any key to enter the REPL. Use CTRL-D to reload.
###mew### hit CTRL-D
soft reboot

Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.
code.py output:
192.168.8.60 | code.py | 9.2.8
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 208, in <module>
  File "main.py", line 90, in InitializeDevices
RuntimeError: No pull up found on SDA or SCL; check your wiring
192.168.8.60 | 90@main.py RuntimeError | 9.2.8
Code done running.

Press any key to enter the REPL. Use CTRL-D to reload.

-----------------------------------------------------------------------------

mew@wopr:github.com !8 0 $ screen /dev/ttyACM0 115200
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 240, in <module>
  File "main.py", line 189, in Sleep
KeyboardInterrupt:
192.168.8.60 | 189@main.py KeyboardInterrupt | 9.2.8
Code done running.

Press any key to enter the REPL. Use CTRL-D to reload.
192.168.8.60 | REPL | 9.2.8
Adafruit CircuitPython 9.2.8 on 2025-05-28; Raspberry Pi Pico W with rp2040
>>>
192.168.8.60 | Done | 9.2.8
soft reboot

Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.
code.py output:
192.168.8.60 | code.py | 9.2.8

version  0.2.0.2
our MAC 28:cd:c1:0d:c1:9b
our ipaddr 192.168.8.60
"2025-11-30T01:43:51Z",-6.2,60.6,735.5,0.776,5.2,12.6,18.3,19.4,20,34,41,43,43





=============================================================================
=============================================================================
=============================================================================
2025-08-29
migrating from feather_esp32s2 to raspberry_pi_w
migrating to circuitpython 9.2.8

Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.
code.py output:
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 207, in <module>
  File "main.py", line 90, in InitializeDevices
AttributeError: 'module' object has no attribute 'SCK'

=============================================================================
Start/Stop the SPS30 (run for 30 seconds before recording a measurement.)

Start/Stop socket

Start/Stop wifi connection?

unpower D13 led, external i2c power.  disable board.NEOPIXEL_POWER

use watchdog to ensure running?

use deep sleep to save power?  sleep the SPS30

check on mpl read protocol, to ensure it doesn't block.

TODO what other shutdown tasks?
TODO prepare to sleep
TODO wake up from sleep
TODO periodic fan cleaning

in the header:
    board.board_id
    CPy version
    microcontroller_id
    dust version

what's a good way to generate build_timestamp (date, g desc)
=============================================================================

>>> import microcontroller
>>> dir(microcontroller)
['__class__', '__name__', 'Pin', 'Processor', 'ResetReason', 'RunMode', 'cpu', 'delay_us', 'disable_interrupts', 'enable_interrupts', 'nvm', 'on_next_reset', 'pin', 'reset', 'watchdog']

>>> dir(microcontroller.watchdog)
['__class__', 'deinit', 'feed', 'mode', 'timeout']
>>> help(microcontroller.watchdog)
object <WatchDogTimer> is of type WatchDogTimer
feed -- <function>
deinit -- <function>
timeout -- <property>
mode -- <property>

>>> import watchdog
>>> dir(watchdog)
['__class__', '__name__', 'WatchDogMode', 'WatchDogTimeout']
>>> help(watchdog)
object <module 'watchdog'> is of type module
__name__ -- watchdog
WatchDogMode -- <class 'WatchDogMode'>
WatchDogTimeout -- <class 'WatchDogTimeout'>

>>> microcontroller.cpu.uid
bytearray(b'\xc7\xfd\x1aI\xb8g')
>>> microcontroller.cpu.temperature
39.4348
>>> microcontroller.cpu.reset_reason
microcontroller.ResetReason.SOFTWARE
>>> str(microcontroller.cpu.reset_reason)
'microcontroller.ResetReason.SOFTWARE'

=============================================================================
Catch network exceptions.  When modem was rebooted...
# TODO handle ECONNECT exception

b'<158>1 2022-07-08T03:31:32Z 192.168.1.65 dust - - - "2022-07-08T03:31:32Z",15.5,68.7,74535,0.464,1.0,1.0,1.0,1.0,7,8,8,8,8'
b'<158>1 2022-07-08T03:36:33Z - dust - - - "2022-07-08T03:36:33Z",15.3,69.3,74547,0.474,0.9,1.0,1.0,1.0,6,7,7,7,7'
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 212, in <module>
  File "main.py", line 149, in WriteCsvData
  File "main.py", line 134, in WriteToSyslog
OSError: [Errno 113] ECONNABORTED

Code done running.

=============================================================================

code.py output:
connecting to AP e7
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 199, in <module>
  File "main.py", line 117, in ConnectToAP
  File "/lib/wifi_socket.py", line 27, in ConnectToAP
ConnectionError: No network with that ssid
"wifi.radio.connect('foo', password)"

Code done running.

=============================================================================

Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.
code.py output:
connecting to AP e7
self.ipaddr 192.168.1.65 (ours)
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 201, in <module>
  File "main.py", line 121, in SocketToSyslog
  File "/lib/wifi_socket.py", line 41, in ConnectToSocket
OSError: [Errno 118] EHOSTUNREACH
"sock.connect(('foo', port))"

Code done running.

=============================================================================

b'<158>1 2022-07-10T22:56:29Z 192.168.1.65 dust - - - "2022-07-10T22:56:28Z",24.9,34.2,74529,0.491,1.1,1.2,1.2,1.2,8,9,9,9,9'
Traceback (most recent call last):
  File "code.py", line 4, in <module>
  File "main.py", line 219, in <module>
  File "main.py", line 126, in SocketToSyslog
OSError: [Errno 118] EHOSTUNREACH
"sock.connect((self.HOST, self.PORT))"

Code done running.

=============================================================================
